name: Notify Discord on push to main or develop

on:
  push:
    branches:
      - develop

jobs:
  notify-discord:
    runs-on: ubuntu-latest

    steps:
      - name: Send notification to Discord
        run: |
          BRANCH_NAME=$(echo ${GITHUB_REF#refs/heads/})
          AUTHOR=$(git log -1 --pretty=format:'%an')
          COMMIT_MESSAGE=$(git log -1 --pretty=%B)
          COMMIT_URL="https://github.com/${GITHUB_REPOSITORY}/commit/${GITHUB_SHA}"

          curl -H "Content-Type: application/json" \
          -d "{\"content\": \"ðŸš€ **New push to ${BRANCH_NAME}** in **${GITHUB_REPOSITORY}**\n\nðŸ‘¤ Author: ${AUTHOR}\n\nðŸ’¬ Commit Message: ${COMMIT_MESSAGE}\n\nðŸ”— [View Commit](${COMMIT_URL})\"}" \
          ${{ secrets.DISCORD_WEBHOOK_URL }}
